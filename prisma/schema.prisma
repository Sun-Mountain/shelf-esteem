generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

enum Role {
  USER
  BETA
  MOD
  ADMIN
}

model Category {
  name  String
  books BookCategory[]

  @@id([name])
}

model IndustryIdentifier {
  type       String
  identifier String
  Book       Book?   @relation(fields: [bookId], references: [id], onDelete: Cascade)
  bookId     String?

  @@id([identifier])
}

model BookCategory {
  id           Int      @id @default(autoincrement())
  book         Book     @relation(fields: [bookId], references: [id], onDelete: Cascade)
  bookId       String
  category     Category @relation(fields: [categoryName], references: [name], onDelete: Cascade)
  categoryName String
}

model Book {
  id                  String               @unique @default(cuid())
  authors             String[]
  categories          BookCategory[]
  description         String?
  industryIdentifiers IndustryIdentifier[]
  language            String
  maturityRating      String?
  pageCount           Int
  publishedDate       String
  publishers          String[]
  thumbnail           String
  title               String
  user                User  @relation(fields: [addedBy], references: [id])
  addedBy             String
  libraries           UserLibraryBook[]
  createdAt           DateTime             @default(now())
  updatedAt           DateTime?
}

model UserLibraryBook {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  books     Book     @relation(fields: [bookId], references: [id], onDelete: Cascade)
  bookId    String
  createdAt DateTime @default(now())
}

model User {
  id            String            @id @default(cuid())
  username      String            @unique
  email         String            @unique
  password      String
  role          Role              @default(USER)
  createdAt     DateTime          @default(now()) @map(name: "created_at")
  updatedAt     DateTime          @updatedAt @map(name: "updated_at")
  libraryBooks  UserLibraryBook[]
  booksAdded    Book[]

  @@map(name: "users")
}
